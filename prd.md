# Homeman 项目需求文档

## 项目概述

### 项目背景
Homepage 是一个现代化的应用程序仪表板，支持 100+ 种服务集成和多语言翻译。但是 Homepage 没有提供管理后台，所有配置都需要手动编辑 YAML 文件，对于不熟悉 YAML 语法的用户来说操作较为复杂。

### 项目目标
Homeman 旨在为 Homepage 提供一个简洁的 Web 管理界面，让用户可以通过可视化的方式管理 Homepage 的配置，无需直接编辑 YAML 文件。

### 核心价值
- 降低 Homepage 配置门槛
- 提供直观的 Web 管理界面
- 确保生成的配置文件符合 Homepage 规范
- 支持配置文件的备份和恢复

## 功能需求

### 核心功能

#### 1. 全局设置管理 ✅
基于 `settings.yaml` 文件的配置管理：
- **基础设置**：网站标题、语言、主题、颜色方案
- **布局设置**：页眉样式、图标样式、链接目标
- **显示设置**：版本显示、Docker 统计、状态样式
- **高级设置**：自定义图标、基础 URL、日志路径
- **实时验证**：表单字段验证和错误提示

#### 2. 书签管理 ✅
基于 `bookmarks.yaml` 文件的书签配置：
- **分组管理**：创建、编辑、删除书签分组
- **书签条目**：添加、编辑、删除书签
- **书签属性**：链接地址、显示名称、图标、描述
- **排序功能**：支持书签和分组的排序
- **批量操作**：支持批量添加和管理

#### 3. 服务管理 ✅
基于 `services.yaml` 文件的服务配置：
- **服务分组**：创建、编辑、删除服务分组
- **服务条目**：添加、编辑、删除服务
- **基础属性**：服务名称、链接、图标、描述
- **监控配置**：站点监控、Ping 检测
- **Docker 集成**：关联 Docker 容器状态
- **状态样式**：自定义状态显示样式

#### 4. 小工具管理 ✅
基于 `widgets.yaml` 文件的小工具配置：
- **小工具类型**：支持 12+ 种监控类型
- **认证配置**：API 密钥、用户名密码认证
- **显示字段**：自定义显示字段
- **连接测试**：实时测试小工具连接
- **自定义映射**：支持自定义 API 字段映射

#### 5. Docker 管理 ✅
基于 `docker.yaml` 文件的 Docker 配置：
- **连接方式**：支持 Unix Socket 和 TCP 连接
- **实例管理**：多 Docker 实例配置
- **高级配置**：Swarm 模式、TLS 安全
- **连接测试**：实时验证 Docker 连接
- **状态监控**：Docker 容器状态集成

#### 6. 配置文件管理 ✅
- **文件读取**：解析现有的 YAML 配置文件
- **文件生成**：将表单数据转换为 YAML 格式
- **备份系统**：自动备份和手动备份
- **恢复功能**：从备份恢复配置
- **下载功能**：下载单个或全部配置文件
- **格式验证**：确保生成的 YAML 文件格式正确
- **版本管理**：备份历史记录和管理

#### 7. YAML 直接编辑 ✅
- **代码编辑器**：集成 CodeMirror 专业代码编辑器
- **语法高亮**：YAML 语法高亮和主题支持
- **实时验证**：输入时即时检测和显示语法错误
- **配置预览**：解析 YAML 内容为 JSON 结构预览
- **文件选择**：支持选择和编辑所有配置文件类型
- **键盘快捷键**：快速保存（Ctrl+S）和验证（Ctrl+Enter）
- **自动备份**：编辑前自动创建备份文件
- **错误提示**：友好的错误信息和修复建议
- **文件状态**：显示配置文件存在状态和修改时间

## 技术方案

### 技术栈选择 ✅

#### 后端技术栈
- **框架**：Flask（已选择并实现）
- **YAML 处理**：PyYAML（完整的读写功能）
- **文件操作**：Python 标准库 + 自研备份系统
- **数据验证**：自研配置验证器
- **API 设计**：RESTful API 标准
- **部署**：Docker + Gunicorn（多种部署方案）

#### 前端技术栈
- **基础技术**：HTML5 + CSS3 + JavaScript
- **UI 框架**：Bootstrap 5（响应式设计）
- **表单处理**：自研验证框架 + 原生 JavaScript
- **图标库**：Font Awesome + 自定义图标支持
- **用户体验**：Toast 通知 + 加载状态 + 错误处理

### 数据流设计 ✅
```
用户操作 → 前端验证 → API 请求 → 后端处理 → YAML 文件 → 备份系统 → Homepage 应用
                ↓
            实时反馈 ← Toast 通知 ← 操作结果
```

#### 核心流程
1. **配置读取**：加载现有 YAML 配置 → 数据验证 → 表单渲染
2. **配置修改**：表单提交 → 前端验证 → API 调用 → 后端验证 → 文件写入 → 自动备份
3. **备份管理**：创建备份 → 列表展示 → 恢复操作 → 文件替换
4. **状态监控**：实时获取配置状态 → 统计计算 → 仪表板显示

### 核心模块设计

#### 1. 配置解析器
- 读取 YAML 配置文件
- 解析为结构化数据
- 数据验证和错误处理

#### 2. 配置生成器
- 接收表单数据
- 转换为 YAML 格式
- 确保格式符合 Homepage 规范

#### 3. 文件管理器
- 文件读写操作
- 配置文件备份
- 文件权限管理

#### 4. Web 界面
- 表单渲染
- 数据提交处理
- 操作结果反馈

## 界面设计

### 页面结构
```
主导航
├── 全局设置
├── 书签管理
├── 服务管理
└── 配置管理
```

### 主要页面

#### 1. 全局设置页面
- **基础设置区域**：标题、语言、主题等
- **布局设置区域**：页眉样式、图标样式等
- **显示设置区域**：版本显示、统计信息等
- **保存按钮**：提交设置更改

#### 2. 书签管理页面
- **分组列表**：显示所有书签分组
- **书签列表**：显示选中分组的书签
- **编辑表单**：添加/编辑书签的表单
- **操作按钮**：添加、编辑、删除、排序

#### 3. 服务管理页面
- **服务分组列表**：显示所有服务分组
- **服务列表**：显示选中分组的服务
- **编辑表单**：添加/编辑服务的表单
- **小工具配置**：为服务配置状态小工具

#### 4. 配置管理页面
- **文件状态**：显示配置文件状态
- **备份列表**：显示历史备份
- **操作按钮**：备份、恢复、下载配置

## 部署方案

### 部署架构
```
用户浏览器 → Web服务器 → Homeman应用 → Homepage配置文件
```

### 部署方式

#### Docker 部署（推荐）
```dockerfile
FROM python:3.9-slim  # 或 php:8.1-apache
WORKDIR /app
COPY . .
RUN pip install -r requirements.txt  # 或 composer install
EXPOSE 8000
CMD ["python", "app.py"]  # 或 apache2-foreground
```

#### 独立部署
- **Python 环境**：Python 3.8+
- **Web 服务器**：Nginx 或 Apache
- **配置文件挂载**：确保可以访问 Homepage 配置目录

### 配置文件路径
- **默认路径**：`/app/config/` (Homepage 标准路径)
- **自定义路径**：通过环境变量配置
- **权限要求**：读写权限

## 开发计划

### 第一阶段：核心功能（4周） ✅ 已完成
- [x] 项目初始化
- [x] YAML 解析和生成功能
- [x] 基础 Web 界面
- [x] 全局设置管理
- [x] 书签管理功能

### 第二阶段：完整功能（3周） ✅ 已完成
- [x] 服务管理功能
- [x] 小工具管理功能
- [x] Docker 管理功能
- [x] 配置文件管理（备份、恢复、下载）
- [x] 错误处理和验证
- [x] 界面优化和用户体验提升

### 第三阶段：部署和文档（1周） ✅ 已完成
- [x] Docker 镜像构建
- [x] 部署文档编写
- [x] 用户使用手册
- [x] 项目发布

### 额外完成的功能
- [x] Docker 管理功能（支持 socket 和 TCP 连接）
- [x] 小工具配置管理（支持多种监控类型）
- [x] 完整的前端验证和错误处理系统
- [x] 响应式设计和移动端适配
- [x] 实时配置状态显示
- [x] 自动化构建脚本（多平台支持）
- [x] YAML 直接编辑功能（专业代码编辑器，语法验证，配置预览）

## 风险评估

### 技术风险
- **YAML 格式兼容性**：确保生成的配置文件符合 Homepage 规范
- **文件权限问题**：Docker 环境下的文件权限管理
- **Homepage 版本兼容性**：不同版本的配置差异

### 解决方案
- 严格按照 Homepage 官方文档实现
- 提供详细的部署文档和权限配置说明
- 定期更新以支持新版本的 Homepage

## 项目约束

### 功能约束
- 仅支持 Homepage 的基础配置功能
- 提供基础的配置预览功能（JSON 格式）
- 不包含复杂的用户权限管理

### 技术约束
- 保持项目轻量级
- 确保配置文件的正确性
- 支持主流的部署环境 